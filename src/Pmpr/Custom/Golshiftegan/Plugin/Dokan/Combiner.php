<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             693b5a611c047             |
    |_______________________________________|
*/
 namespace Pmpr\Custom\Golshiftegan\Plugin\Dokan; use Pmpr\Custom\Golshiftegan\Container; class Combiner extends Container { private $css_dir; private $js_dir; public function __construct() { $upload_dir = wp_upload_dir(); $this->css_dir = $upload_dir['basedir'] . '/asset-cache/css/'; $this->js_dir = $upload_dir['basedir'] . '/asset-cache/js/'; if (!file_exists($this->css_dir)) { wp_mkdir_p($this->css_dir); } if (!file_exists($this->js_dir)) { wp_mkdir_p($this->js_dir); } add_action('wp_enqueue_scripts', [$this, 'combine_assets'], 10000); } public function combine_assets() { global $wp_styles, $wp_scripts; if (!isset($wp_styles) || !isset($wp_scripts)) { return; } $css_handles = $wp_styles->queue; sort($css_handles, SORT_STRING); $css_hash = substr(md5(implode(',', $css_handles)), 0, 16); $css_file = $this->css_dir . $css_hash . '.css'; $css_url = wp_upload_dir()['baseurl'] . '/asset-cache/css/' . $css_hash . '.css'; if (!file_exists($css_file)) { $css_content = ''; foreach ($css_handles as $eueuqacmukymcyya) { if (isset($wp_styles->registered[$eueuqacmukymcyya])) { $ogomymegcoacqisg = $wp_styles->registered[$eueuqacmukymcyya]->src; $ogomymegcoacqisg = $this->resolve_url_to_path($ogomymegcoacqisg); if (file_exists($ogomymegcoacqisg)) { $css_content .= file_get_contents($ogomymegcoacqisg) . "\n"; } } } file_put_contents($css_file, $this->minify_css($css_content)); } $js_handles = $wp_scripts->queue; $js_handles = array_diff($js_handles, ['jquery', 'jquery-core', 'jquery-migrate']); sort($js_handles, SORT_STRING); $js_hash = substr(md5(implode(',', $js_handles)), 0, 16); $js_file = $this->js_dir . $js_hash . '.js'; $js_url = wp_upload_dir()['baseurl'] . '/asset-cache/js/' . $js_hash . '.js'; if (!file_exists($js_file)) { $js_content = ''; foreach ($js_handles as $eueuqacmukymcyya) { if (isset($wp_scripts->registered[$eueuqacmukymcyya])) { $ogomymegcoacqisg = $wp_scripts->registered[$eueuqacmukymcyya]->src; $ogomymegcoacqisg = $this->resolve_url_to_path($ogomymegcoacqisg); if (file_exists($ogomymegcoacqisg)) { $js_content .= file_get_contents($ogomymegcoacqisg) . ";\n"; } } } file_put_contents($js_file, $this->minify_js($js_content)); } foreach ($wp_styles->queue as $eueuqacmukymcyya) { wp_dequeue_style($eueuqacmukymcyya); } foreach ($wp_scripts->queue as $eueuqacmukymcyya) { if (!in_array($eueuqacmukymcyya, ['jquery', 'jquery-core', 'jquery-migrate'])) { wp_dequeue_script($eueuqacmukymcyya); } } wp_enqueue_style('combined-css', $css_url, [], null); wp_enqueue_script('combined-js', $js_url, [], null, true); } private function resolve_url_to_path($eeamcawaiqocomwy) { if (strpos($eeamcawaiqocomwy, home_url()) === 0) { $eeamcawaiqocomwy = str_replace(home_url(), ABSPATH, $eeamcawaiqocomwy); } elseif (strpos($eeamcawaiqocomwy, site_url()) === 0) { $eeamcawaiqocomwy = str_replace(site_url(), ABSPATH, $eeamcawaiqocomwy); } return strtok($eeamcawaiqocomwy, '?'); } private function minify_css($iesegggmcccqyquo) { $iesegggmcccqyquo = preg_replace('!/\\*.*?\\*/!s', '', $iesegggmcccqyquo); $iesegggmcccqyquo = preg_replace('/\\s+/', ' ', $iesegggmcccqyquo); $iesegggmcccqyquo = str_replace(["\r", "\n", "\t"], '', $iesegggmcccqyquo); $iesegggmcccqyquo = preg_replace('/\\s*([:;{}])\\s*/', '$1', $iesegggmcccqyquo); return trim($iesegggmcccqyquo); } private function minify_js($oqkcmcewgaqymmoe) { $oqkcmcewgaqymmoe = preg_replace('/\\/\\/[^\\n]*\\n/', '', $oqkcmcewgaqymmoe); $oqkcmcewgaqymmoe = preg_replace('/\\s+/', ' ', $oqkcmcewgaqymmoe); $oqkcmcewgaqymmoe = str_replace(["\r", "\n", "\t"], '', $oqkcmcewgaqymmoe); return trim($oqkcmcewgaqymmoe); } }
